import streamlit as st
from openai import OpenAI

#----------------------------------------------------------------------------------------------------------------------#
# ุฅุนุฏุงุฏ ุนููู OpenAI ุจุงุณุชุฎุฏุงู ููุงุชูุญ Groq API

client = OpenAI(
    api_key=st.secrets["GROQ_API_KEY"],
    base_url="https://api.groq.com/openai/v1"
)

#----------------------------------------------------------------------------------------------------------------------#
# ุฅุนุฏุงุฏ ูุงุฌูุฉ ุงูุชุทุจูู

st.set_page_config(page_title="ููุจูุง ุงูุณ - ุงููุณุงุนุฏ ุงูุฐูู", layout="wide")

#----------------------------------------------------------------------------------------------------------------------#
# ุชููุฆุฉ ุงูุฌูุณุฉ (session_state) ูุฃูู ูุฑุฉ ูุชุฎุฒูู ุงูุฑุณุงุฆู ูุงููุญุงุฏุซุฉ

if "messages" not in st.session_state:
    st.session_state.messages = [
        {
            "role": "system",
            "content": """
ุฃูุช ูุณุงุนุฏ ุฐูู ุฑุณูู ุชุงุจุน ูููุตุฉ ููุจูุง ุฅูุณ - Libya X. ุชุฃุณุณุช ุงูููุตุฉ ูู ุณูุฉ 2022 ูุชูุนุฏ ููุฒุนูุง ูุนุชูุฏูุง ูุงุดุชุฑุงูุงุช IPTV ุฏุงุฎู ููุจูุง.

ุชุฑุฏ ููุท ุนูู ุงูููุงุถูุน ุงูุชุงููุฉ:
1- ุงูุงุดุชุฑุงูุงุช ูุงูุณูุฑูุฑุงุช ุงูุฑุณููุฉ.
2- ุงูุฃุณุนุงุฑุ ุงููุฏุฉุ ูุงูุฃููุงุฏ ุงูุชุฌุฑูุจูุฉ.
3- ุทุฑู ุงูุฏูุน.
4- ุงูุฏุนู ุงูููู ูุงูุชูุนูู.
5- ุงูุฃุฌูุฒุฉ ุงููุฏุนููุฉ.
6- ุชูุจููุงุช ุงูุฃูุงู ูุงูุซูุฉ.

โ ูุง ุชุฑุฏ ุนูู ุฃู ุงุณุชูุณุงุฑ ูุง ูุชุนูู ุจู IPTV ุฃู ุฎุงุฑุฌ ุฎุฏูุงุช ููุจูุง ุฅูุณ. ุจู ุชุนุชุฐุฑ ุจุงุญุชุฑุงู ูุชูุดูุฑ ุฅูู ุฃูู ูุณุงุนุฏ ุฑุณูู ูุฎุฏูุฉ ูุญุฏุฏุฉ ููุท.

---

**ูุง ูู IPTVุ**  
ูู ุชุทุจูู ูุชู ุชุญูููู ุนูู ุฃุฌูุฒุฉ Android TV ุฃู TV Box ุฃู ุดุงุดุงุช ุณูุงุฑุช ุฃูุฏุฑููุฏ . ููููู ูู ุฎูุงูู ูุดุงูุฏุฉ ูููุงุช ุฑูุงุถูุฉุ ุฃููุงูุ ูุณูุณูุงุชุ ูุจุงูุงุช ุนุงูููุฉ.

**ู ููุงู ูุนูู ุนูู ุฃุฌูุฒุฉ iPhone ู ุงูููุจููุชุฑ.**

---

**โ ุงูุณูุฑูุฑุงุช ูุงูุฃุณุนุงุฑ:**

**ุณูุฑูุฑ ุงูุณ**  
3 ุฃุดูุฑ: 40 ุฏ.ู | 6 ุฃุดูุฑ: 70 ุฏ.ู | 1 ุณูุฉ: 120 ุฏ.ู  
โฑ ูุชููุฑ ููุฏ ุชุฌุฑูุจู: 12 ุณุงุนุฉ

**ุณูุฑูุฑ ูููุง**  
3 ุฃุดูุฑ: 35 ุฏ.ู | 6 ุฃุดูุฑ: 60 ุฏ.ู | 1 ุณูุฉ: 100 ุฏ.ู  
โฑ ูุชููุฑ ููุฏ ุชุฌุฑูุจู: 12 ุณุงุนุฉ

**ุณูุฑูุฑ ูุงุฑูู**  
3 ุฃุดูุฑ: 35 ุฏ.ู | 6 ุฃุดูุฑ: 65 ุฏ.ู | 1 ุณูุฉ: 115 ุฏ.ู  
โฑ ูุชููุฑ ููุฏ ุชุฌุฑูุจู: 24 ุณุงุนุฉ

**ุณูุฑูุฑ ูุงููู**  
1 ุดูุฑ: 25 ุฏ.ู | 3 ุฃุดูุฑ: 35 ุฏ.ู | 6 ุฃุดูุฑ: 55 ุฏ.ู | 1 ุณูุฉ: 95 ุฏ.ู  
โฑ ูุชููุฑ ููุฏ ุชุฌุฑูุจู: 12 ุณุงุนุฉ

**ุณูุฑูุฑ MH**  
3 ุฃุดูุฑ: 45 ุฏ.ู | 6 ุฃุดูุฑ: 75 ุฏ.ู | 1 ุณูุฉ: 130 ุฏ.ู  
โฑ ูุชููุฑ ููุฏ ุชุฌุฑูุจู: 6 ุณุงุนุงุช

**ุณูุฑูุฑ MYHD**  
1 ุดูุฑ: 20 ุฏ.ู | 3 ุฃุดูุฑ: 35 ุฏ.ู | 6 ุฃุดูุฑ: 45 ุฏ.ู | 1 ุณูุฉ: 75 ุฏ.ู  
โ ูุง ููุฌุฏ ููุฏ ุชุฌุฑูุจู

**ุณูุฑูุฑ LYNX**  
1 ุดูุฑ: 20 ุฏ.ู | 3 ุฃุดูุฑ: 35 ุฏ.ู | 1 ุณูุฉ: 90 ุฏ.ู  
โ ูุง ููุฌุฏ ููุฏ ุชุฌุฑูุจู

**ุณูุฑูุฑ GOGO**  
3 ุฃุดูุฑ: 45 ุฏ.ู | 1 ุณูุฉ: 100 ุฏ.ู  
โ ูุง ููุฌุฏ ููุฏ ุชุฌุฑูุจู

**ุณูุฑูุฑ Aroma**  
1 ุดูุฑ: 35 ุฏ.ู | 3 ุฃุดูุฑ: 60 ุฏ.ู | 1 ุณูุฉ: 120 ุฏ.ู  
โ ูุง ููุฌุฏ ููุฏ ุชุฌุฑูุจู

**ุณูุฑูุฑ Megastar**  
1 ุณูุฉ: 55 ุฏ.ู  
โ ูุง ููุฌุฏ ููุฏ ุชุฌุฑูุจู

---

**ุทุฑู ุงูุฏูุน ุงูุฑุณููุฉ:**
1. ูุฑูุช ุงูุฏูุน ุงููุณุจู ุฃู ุชุญููู ุฑุตูุฏ (ููุจูุงูุง ุฃู ุงููุฏุงุฑ)
2. ูุฑูุช ุนุฑุจูุช ุงูุชุงุจุนู ูุจุฑูุงูุฌ BN PLUS
3. ุฎุฏูุฉ ุงูุจุทุงูุฉ ุงููุตุฑููุฉ ูุน (ุฎุตู 10%)
4. ุฎุฏูุฉ ุณุฏุงุฏ ูุน (ุฎุตู 10%)
5. ุฎุฏูุฉ ุงูุชุฏุงูู ูุน (ุฎุตู 10%)
6. ุฎุฏูุฉ ุฅุฏูุน ูู ูุน (ุฎุตู 10%)
7. ุฎุฏูุฉ ุชุญููู USDT ูู ุจุฑูุงูุฌ BINANCE
   - 3 ุฃุดูุฑ: 5 $
   - 6 ุฃุดูุฑ: 9 $
   - 1 ุณูุฉ: 16 $
   - Binance ID: 804907149

---

**ููุฏ ุชุฌุฑูุจูุ**  
ููุญุตูู ุนูู ููุฏ ุชุฌุฑูุจู (ูุฏุฉ 6 ุฃู 12 ุฃู 24 ุณุงุนุฉ ุญุณุจ ุงูุณูุฑูุฑ)ุ ุชูุงุตู ูุนูุง ุนุจุฑ:

- ุงููุงุชุณุงุจ :
 https://wa.me/218945772649  
 
- ุงูุงุชุตุงู ุนูู ุฑูู:
 0945772649  
 
- ุตูุญุงุช ุงูููุณุจูู ุงูุฑุณููุฉ:
  1- https://www.facebook.com/share/1Au4jF6o2n/
  2- https://www.facebook.com/share/1EeZhEbLjR/

---

**ููุช ุงูุชูุนูู:**  
ูุชู ุชูุนูู ุงูุงุดุชุฑุงู ุนุงุฏุฉ ุฎูุงู 5 ุฅูู 15 ุฏูููุฉ ูู ุชุฃููุฏ ุงูุฏูุน.

**ุฎุฏูุฉ ุงูุนููุงุก:**  
ูู ุญุงู ูุฌูุฏ ูุดููุฉุ ูุฑุฌู ุงูุชูุงุตู ูุนูุง ุนุจุฑ ููุณ ุงูุฑูู ุฃู ุจุฑูุฏ ุงูุตูุญุฉ.

---

**ุชูุจูู ูุงู:** 
ุงูุฌูุงุช ุงููุนุชูุฏู ูุฏููุง
1- ุงููุธูุฉ ู ุงููุถูู ู ุดุฑูุฉ ุงููุธูุฉ ู ุจุฑูุงูุฌ ุงููุงุฑุฏ ู icard
2- ุจุฑูุงูุฌ ุจู ู bn , ุจู ุจูุณ ู BN PLUS
3- ุตูุญุงุชูุง ุนูู ุงูููุณุจูู ุงู ุงููุงุชุณุงุจ ููุท
 
โ ุงูุงุดุชุฑุงูุงุช ุชุชู ููุท ูู ุฎูุงู:
- ุตูุญุงุช ููุจูุง ุงูุณ ุงููุฐููุฑุฉ ูู ุงูุฃุนูู ููุท
ุฃู ุนู ุทุฑูู ููุงุท ุงูุจูุน ุงูุชุงุจุนู ูู ุดุฑูุฉ ุงููุธูุฉ Umbrella LTD ุงู ุชุทุจูู iCard
ุงู ุชุทุจูู BN Plus
โ ููุณูุง ูุณุคูููู ุนู ุฃู ูุฑูุช ุงู ุงุดุชุฑุงูุงุช ูู ุงู ุฌูุฉ ุบูุฑ ูุนุชูุฏูุง ูุฏููุง .

---
**ุฌูุฏุฉ ุงูุฎุฏูุฉ:**  
ุฌููุน ุงูุงุดุชุฑุงูุงุช ูุชู ุชูุนูููุง ูู ุฎูุงู ุฃูุธูุชูุง ุงูุฑุณููุฉ ูุถูุงู ุงูุฌูุฏุฉ ูุงูุซุจุงุช.

---
**ุงููุบุฉ:**  
ุงุณุชุฎุฏู ุงููุบุฉ ุงูุนุฑุจูุฉ ุฏุงุฆููุง ุฅูุง ุฅุฐุง ุชู ุณุคุงูู ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉุ ูุชุฑุฏ ุจูุง ููุท.

ุฏุงุฆูุง ุงุฌุนู ุงูุฑูุงุจุท ุชููู ูู ุณุทุฑ ูููุฑุฏ ููู ุชุนูู ูู ุงููุญุงุฏุซู
"""
        }
    ]

if "chat" not in st.session_state:
    st.session_state.chat = []

#----------------------------------------------------------------------------------------------------------------------#
# CSS ูุชูุณูู ุงููุญุงุฏุซุฉ ูุฅุฏุฎุงู ููุณู

st.markdown("""
    <style>
        .chat-history {
            max-height: 60vh;
            overflow-y: auto;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #fdfdfd;
            margin-bottom: 100px;
            font-size: 22px !important;
            font-weight: bold !important;
            line-height: 2.2;
        }
        .chat-input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #ffffff;
            padding: 10px 5%;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05);
            z-index: 1000;
        }
        .stTextInput > div > input {
            padding: 10px !important;
            border-radius: 10px !important;
            border: 1px solid #ccc !important;
            font-size: 18px !important;
            font-weight: bold !important;
        }
        .stButton>button {
            background-color: #f0f0f0;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 16px;
            margin-right: 5px;
            cursor: pointer;
            transition: 0.3s;
        }
        .stButton>button:hover {
            background-color: #e0e0e0;
        }
        input[type="text"] {
            direction: rtl !important;
            text-align: right !important;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }
    </style>
""", unsafe_allow_html=True)

#----------------------------------------------------------------------------------------------------------------------#
# ุนุฑุถ ุงูุดุนุงุฑ ูุงูุนููุงู

col_logo, col_title, col_features = st.columns([20, 20, 20])
with col_logo:
    st.image("https://raw.githubusercontent.com/almezo/Libya-X/main/Libya_X_CHATBOT/libyax_logo.png", width=200)
with col_title:
    st.markdown("""
        <div style='text-align: center; margin-top: 10px;'>
            <h3><span style='color:green;'>ูุฑุญุจุงู ุจู </span> ูู <span style='color:red;'> ููุจูุง ุงูุณ </span><h3> ุงูููุตุฉ ุงูุฑุงุฆุฏุฉ ูู ุจูุน ุงุดุชุฑุงูุงุช <h3><b style='color:red;'>IP<b style='color:black;'>T<b style='color:green;'>V</b></h3>
        </div>
    """, unsafe_allow_html=True)
with col_features:
    st.markdown("""
        <div dir="rtl" style="text-align: right; margin-top: 10px;">
            <ul>
                <li>ููุฒุน ูุนุชูุฏ ูู ููุจูุง</li>
                <li>ุจุงูุงุช ูููุงุช ูุถุงุฆูุฉ</li>
                <li>ุจุงูุงุช ุฃููุงู ููุณูุณูุงุช ุนุงูููุฉ</li>
                <li>ุงุดุชุฑุงูุงุช ุดูุฑูุฉ ูุณูููุฉ ุจุฃุณุนุงุฑ ููุงูุณุฉ</li>
            </ul>
        </div>
    """, unsafe_allow_html=True)

st.markdown("<hr>", unsafe_allow_html=True)

#----------------------------------------------------------------------------------------------------------------------#
# ุนุฑุถ ุณุฌู ุงููุญุงุฏุซุฉ

st.markdown("<h4 style='text-align: center;'>๐ ุณุฌู ุงููุญุงุฏุซุฉ</h4>", unsafe_allow_html=True)
st.markdown("<div class='chat-history'>", unsafe_allow_html=True)
for speaker, msg in st.session_state.chat:
    align = "right" if speaker == "ุฃูุช" else "right"
    st.markdown(f"<div dir='rtl' style='text-align: {align}; padding: 10px 20px;'><b>{speaker}:</b> {msg}</div>", unsafe_allow_html=True)
st.markdown("</div>", unsafe_allow_html=True)

#----------------------------------------------------------------------------------------------------------------------#
# ูููุฐุฌ ุงูุฅุฏุฎุงู

st.markdown("<div class='chat-input-container'>", unsafe_allow_html=True)
with st.form(key="chat_form", clear_on_submit=True):
    col1, col2, col3 = st.columns([70, 4, 5])
    user_input = col1.text_input(label="", placeholder="ุงูุชุจ ุงุณุชูุณุงุฑู ููุง... ๐ฌ")
    send_clicked = col2.form_submit_button("ุฅุฑุณุงู ๐จ")
    clear_clicked = col3.form_submit_button("ูุณุญ ุงูุณุฌู ๐๏ธ")
st.markdown("</div>", unsafe_allow_html=True)

#----------------------------------------------------------------------------------------------------------------------#
# ูุณุญ ุงูุณุฌู

if clear_clicked:
    st.session_state.chat.clear()
    st.session_state.messages = [
        {"role": "system", "content": "ุฃูุช ูุณุงุนุฏ ุฐูู ุจุงุณู ููุจูุง ุงูุณ Libya X. ุฑุฏ ุจุงุญุชุฑุงููุฉ ูุจุงููุบุฉ ุงูุนุฑุจูุฉ ุฃู ุงูุฅูุฌููุฒูุฉ ุฅุฐุง ุฃูุฑุณูุช ููุ ููู ูุฏูุฏูุง ููุงุถุญูุง ุญูู ุงูุงุดุชุฑุงูุงุชุ ุงูุฃุณุนุงุฑุ ุทุฑู ุงูุฏูุนุ ูุงูุฏุนู ุงูููู."}
    ]
    st.rerun()

#----------------------------------------------------------------------------------------------------------------------#
# ุงูุฑุฏ ุนูู ุฑุณุงุฆู ุงููุณุชุฎุฏู

if send_clicked and user_input.strip():
    msg = user_input.strip()
    st.session_state.messages.append({"role": "user", "content": msg})
    st.session_state.chat.append(("ุฃูุช", msg))

    with st.spinner("๐ค ูุชู ุชูููุฏ ุงูุฑุฏ ุจูุงุณุทุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู..."):
        reply = client.chat.completions.create(
            model="llama3-70b-8192",
            messages=st.session_state.messages,
            temperature=0.7
        ).choices[0].message.content

    st.session_state.messages.append({"role": "assistant", "content": reply})
    st.session_state.chat.append(("ููุจูุง ุฅูุณ", reply))
    st.rerun()
